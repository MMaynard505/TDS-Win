. TDSLBLPR.DBS Print Mailing labels from the monthly control file, CSCFILES.DAT                                                                                                                                                                                
. V.M=1.1                                                                                                                                                                                                                                                      
.                                                                                                                                                                                                                                                              
. ****************************************************************************                                                                                                                                                                                 
.                                                                                                                                                                                                                                                              
. --DATE--  -----------------------MODIFICATION----------------------------                                                                                                                                                                                    
. 11/22/92  Program created from TDSENVPR.DBS                                                                                                                                                                                                                  
.                                                                                                                                                                                                                                                              
. 01/13/96  Modified to read mailing information from CUSTMAST via CUSTFNi                                                                                                                                                                                     
.           This is a secondary index into CUSTMAST via the unique cust name                                                                                                                                                                                   
.           Ver 1.1                                                                                                                                                                                                                                            
.                                                                                                                                                                                                                                                              
.                                                                                                                                                                                                                                                              
.                                                                                                                                                                                                                                                              
.                                                                                                                                                                                                                                                              
.                                                                                                                                                                                                                                                              
.                                                                                                                                                                                                                                                              
. ****************************************************************************                                                                                                                                                                                 
.                                                                                                                                                                                                                                                              
         INCLUDE   COMMON/INC                                                                                                                                                                                                                                  
FF       INIT      0x0C                                                                                                                                                                                                                                        
TOF      INIT      0x0E             /* Special characters in CSCFILES.DAT                                                                                                                                                                                      
BOF      INIT      0xFB             /*                                                                                                                                                                                                                         
RecZero  FORM      "0"                                                                                                                                                                                                                                         
                                                                                                                                                                                                                                                               
DIM60    DIM       60                                                                                                                                                                                                                                          
DIM1     DIM       1                                                                                                                                                                                                                                           
DIM2     DIM       2                                                                                                                                                                                                                                           
NUMWK2A  FORM      "00"                                                                                                                                                                                                                                        
NUMWK2B  INTEGER   2                                                                                                                                                                                                                                           
NUMWK3   FORM      "00.0"                                                                                                                                                                                                                                      
                                                                                                                                                                                                                                                               
SPACES   DIM       80                                                                                                                                                                                                                                          
REPLY    INIT      "N"     FORMS ALIGNMENT REPLY                                                                                                                                                                                                               
INTSW    INIT      " "     Y=Interrupt in progress                                                                                                                                                                                                             
Firstime INIT      "Y"                                                                                                                                                                                                                                         
Label    INIT      "1"     /* 1 or 2                                                                                                                                                                                                                           
TRYD     INIT      "Y"                                                                                                                                                                                                                                         
SELECTED INIT      "N"     /* Y=Allow for selected labels, M=Manual labels                                                                                                                                                                                     
SFOpenSW INIT      "N"     /* Y=Spool file is already open                                                                                                                                                                                                     
InitLbl  INIT      0x1B,"&l3h1o26E":                                                                                                                                                                                                                           
                   0x1B,"(s10h10v0s0b3T":                                                                                                                                                                                                                      
                   0x1B,")s10h10v0s0b3T":                                                                                                                                                                                                                      
                   0x1B,"&a1R"                                                                                                                                                                                                                                 
ResetLJ  INIT      0x1B,"E"                                                                                                                                                                                                                                    
MM       DIM       2                                                                                                                                                                                                                                           
DD       DIM       2                                                                                                                                                                                                                                           
YY       DIM       2                                                                                                                                                                                                                                           
WORK2    DIM       2                                                                                                                                                                                                                                           
                                                                                                                                                                                                                                                               
CTRLFILE IFILE     VARIABLE=1024,NODUP,WEOF                                                                                                                                                                                                                    
CFName   INIT      "C:\CSCDATA\CSCFILES"                                                                                                                                                                                                                       
                                                                                                                                                                                                                                                               
CustFNi  IFILE     VARIABLE=1024                                                                                                                                                                                                                               
                                                                                                                                                                                                                                                               
SPLFILE  FILE                   /* Used to check for spool file                                                                                                                                                                                                
SFNAME   DIM       80           /*      "TDSLBLPR.PRT"                                                                                                                                                                                                         
.                                                                                                                                                                                                                                                              
.                                                                                                                                                                                                                                                              
CMKey    DIM       8            /* Key to the CUSTFNi file                                                                                                                                                                                                     
KEY      DIM       8            /* Key to the CUSTFNi file (secondary)                                                                                                                                                                                         
KeyCheck DIM       8                                                                                                                                                                                                                                           
SAVEKEY  DIM       8                                                                                                                                                                                                                                           
CTRLKEY  DIM       12                                                                                                                                                                                                                                          
SEQ      FORM      "-2"                                                                                                                                                                                                                                        
SEQ1     FORM      "-2"                                                                                                                                                                                                                                        
SEQ2     FORM      "-2"                                                                                                                                                                                                                                        
EOJSW    DIM       1                                                                                                                                                                                                                                           
FIRSTSW  DIM       1                                                                                                                                                                                                                                           
CR       EQU       015     /*              Printer Carriage Return                                                                                                                                                                                             
LF       EQU       012     /*              Printer Line Feed                                                                                                                                                                                                   
.                                                                                                                                                                                                                                                              
MONTH    DIM       2                                                                                                                                                                                                                                           
DAY      DIM       2                                                                                                                                                                                                                                           
YEAR     DIM       2                                                                                                                                                                                                                                           
DRIVE    INIT      ":"                                                                                                                                                                                                                                         
Pline    DIM       38                   /* Maximum label width                                                                                                                                                                                                 
NbrLbls  FORM      "  0"                /* Number of labels printed                                                                                                                                                                                            
RecIn    DIM       127                                                                                                                                                                                                                                         
FILL     INIT      "________________________________________"                                                                                                                                                                                                  
                                                                                                                                                                                                                                                               
         INCLUDE   C:\TDS\TJONCMDS.INC     /* Customer Master Record Description                                                                                                                                                                               
                                                                                                                                                                                                                                                               
KeyLine1 DIM       38                                                                                                                                                                                                                                          
KeyLine2 DIM       38                                                                                                                                                                                                                                          
KeyLine3 DIM       38                                                                                                                                                                                                                                          
KeyLine4 DIM       38                                                                                                                                                                                                                                          
KeyLine5 DIM       38                                                                                                                                                                                                                                          
.                                                                                                                                                                                                                                                              
Line1A   DIM       38                                                                                                                                                                                                                                          
Line2A   DIM       38                                                                                                                                                                                                                                          
Line3A   DIM       38                                                                                                                                                                                                                                          
Line4A   DIM       38                                                                                                                                                                                                                                          
Line5A   DIM       38                                                                                                                                                                                                                                          
.                                                                                                                                                                                                                                                              
Line1B   DIM       38                                                                                                                                                                                                                                          
Line2B   DIM       38                                                                                                                                                                                                                                          
Line3B   DIM       38                                                                                                                                                                                                                                          
Line4B   DIM       38                                                                                                                                                                                                                                          
Line5B   DIM       38                                                                                                                                                                                                                                          
.                                                                                                                                                                                                                                                              
. ษออออออออออออออออออออออออออออออออออออออออออออออออออออออออออออออออออออออออออออป                                                                                                                                                                               
. บ                                                                            บ                                                                                                                                                                               
. บ    LC2UC.INC       22 November 92 (Added numbers)                          บ                                                                                                                                                                               
. บ                                                                            บ                                                                                                                                                                               
. บ        Lower case to Upper Case translation table                          บ                                                                                                                                                                               
. บ                                                                            บ                                                                                                                                                                               
LC2UC    INIT   "aAbBcCdDeEfFgGhHiIjJkKlLmMnNoOpPqQrRsStTuUvVwWxXyYzZ":        บ                                                                                                                                                                               
                "00112233445566778899",0x00,0x20                               บ                                                                                                                                                                               
. บ                                                                            บ                                                                                                                                                                               
. บ                                                                            บ                                                                                                                                                                               
. ศออออออออออออออออออออออออออออออออออออออออออออออออออออออออออออออออออออออออออออผ                                                                                                                                                                               
.                                                                                                                                                                                                                                                              
. INITIALIZE FILLERS TO SPACES...JMM                                                                                                                                                                                                                           
.                                                                                                                                                                                                                                                              
.                                                                                                                                                                                                                                                              
TDSENVPR RESET     SPACES TO 80                                                                                                                                                                                                                                
         LENSET    SPACES                                                                                                                                                                                                                                      
         RESET     SPACES                                                                                                                                                                                                                                      
                                                                                                                                                                                                                                                               
         TRAP      INT IF INTERRUPT                                                                                                                                                                                                                            
                                                                                                                                                                                                                                                               
OpenINV                                                                                                                                                                                                                                                        
         TRAP      NoCM IF IO                                                                                                                                                                                                                                  
         OPEN      CustFNi,"C:\TDS\CUSTFNI"                                                                                                                                                                                                                    
         TRAPCLR   IO                                                                                                                                                                                                                                          
                                                                                                                                                                                                                                                               
         TRAP      CFMISS IF IO                                                                                                                                                                                                                                
         OPEN      CTRLFILE,CFName                                                                                                                                                                                                                             
         TRAPCLR   IO                                                                                                                                                                                                                                          
                                                                                                                                                                                                                                                               
         MOVE      "N" TO EOJSW                                                                                                                                                                                                                                
         MOVE      "********" TO SaveKey                                                                                                                                                                                                                       
                                                                                                                                                                                                                                                               
         UNPACK    TODAY TO MM, REPLY, DD, REPLY, YY                                                                                                                                                                                                           
                                                                                                                                                                                                                                                               
         DISPLAY   *COLOR 23,*ES:                                                                                                                                                                                                                              
                   *P10:04,*COLOR 19,"TDS Conversions, Inc.":                                                                                                                                                                                                  
                   " Mailing Label Print Program":                                                                                                                                                                                                             
                   "  V.M=1.1 ",*COLOR 23;                                                                                                                                                                                                                     
                                                                                                                                                                                                                                                               
GETHC                                                                                                                                                                                                                                                          
         KEYIN     *P1:07,*COLOR 23:                                                                                                                                                                                                                           
                   *P1:07,"Create All return labels, ":                                                                                                                                                                                                        
                   *P1:09,"       Selected labels,":                                                                                                                                                                                                           
                   *P1:11,"       Manual label entry,":                                                                                                                                                                                                        
                   *P1:13,"  or   Exit. (A,S,M,E) ",*EL:                                                                                                                                                                                                       
                   *P8:07,*HON,"A",*P8:09,"S",*P8:11,"M",*P8:13,"E",*HOFF:                                                                                                                                                                                     
                   *P30:13,*UC,*+,REPLY,*LC;                                                                                                                                                                                                                   
         CMATCH    "A" TO REPLY                                                                                                                                                                                                                                
         GOTO      CKSF IF EQUAL                                                                                                                                                                                                                               
         CMATCH    "X" TO REPLY                                                                                                                                                                                                                                
         GOTO      ShutDown IF EQUAL                                                                                                                                                                                                                           
         CMATCH    "E" TO REPLY                                                                                                                                                                                                                                
         GOTO      ShutDown IF EQUAL                                                                                                                                                                                                                           
         CMOVE     "Y" TO SELECTED     /* Assume request for selected labels                                                                                                                                                                                   
         CMATCH    "S" TO REPLY                                                                                                                                                                                                                                
         GOTO      CKSF IF EQUAL                                                                                                                                                                                                                               
         CMOVE     "M" TO SELECTED     /* Assume manual labels                                                                                                                                                                                                 
         CMATCH    "M" TO REPLY                                                                                                                                                                                                                                
         GOTO      CKSF IF EQUAL                                                                                                                                                                                                                               
         CMOVE     "N" TO SELECTED     /* Indicate no selection                                                                                                                                                                                                
         GOTO      GETHC                                                                                                                                                                                                                                       
                                                                                                                                                                                                                                                               
Manual                                                                                                                                                                                                                                                         
         UNPACK    FILL TO KeyLine1                                                                                                                                                                                                                            
         UNPACK    FILL TO KeyLine2                                                                                                                                                                                                                            
         UNPACK    FILL TO KeyLine3                                                                                                                                                                                                                            
         UNPACK    FILL TO KeyLine4                                                                                                                                                                                                                            
         UNPACK    FILL TO KeyLine5                                                                                                                                                                                                                            
         KEYIN     *P1:15,*COLOR 23:                                                                                                                                                                                                                           
                   *P1:15,*HON," Enter label information. ",*HOFF,*EF:                                                                                                                                                                                         
                   *P1:16,*HON,"   ( 5 Lines per label )  ",*HOFF:                                                                                                                                                                                             
                   *LC,*IT:                                                                                                                                                                                                                                    
                   *P27:15,"Line 1: ",*P40:15,*DV,KeyLine1:                                                                                                                                                                                                    
                   *P40:15,*EDIT,KeyLine1,*P40:15,*DV,Keyline1:                                                                                                                                                                                                
                   *P27:16,"Line 2: ",*P40:16,*DV,KeyLine2:                                                                                                                                                                                                    
                   *P40:16,*EDIT,KeyLine2,*P40:16,*DV,Keyline2:                                                                                                                                                                                                
                   *P27:17,"Line 3: ",*P40:17,*DV,KeyLine3:                                                                                                                                                                                                    
                   *P40:17,*EDIT,KeyLine3,*P40:17,*DV,Keyline3:                                                                                                                                                                                                
                   *P27:18,"Line 4: ",*P40:18,*DV,KeyLine4:                                                                                                                                                                                                    
                   *P40:18,*EDIT,KeyLine4,*P40:18,*DV,Keyline4:                                                                                                                                                                                                
                   *P27:19,"Line 5: ",*P40:19,*DV,KeyLine5:                                                                                                                                                                                                    
                   *P40:19,*EDIT,KeyLine5,*P40:19,*DV,Keyline5:                                                                                                                                                                                                
                   *EL;                                                                                                                                                                                                                                        
         CMATCH    "Y" TO Firstime                                                                                                                                                                                                                             
         CALL      InitPrtr IF EQUAL                                                                                                                                                                                                                           
         CMATCH    "2" TO Label                                                                                                                                                                                                                                
         GOTO      PRINTM2 IF EQUAL                                                                                                                                                                                                                            
PRINTM1                                                                                                                                                                                                                                                        
         UNPACK    SPACES TO Line1A                                                                                                                                                                                                                            
         UNPACK    SPACES TO Line2A                                                                                                                                                                                                                            
         UNPACK    SPACES TO Line3A                                                                                                                                                                                                                            
         UNPACK    SPACES TO Line4A                                                                                                                                                                                                                            
         UNPACK    SPACES TO Line5A                                                                                                                                                                                                                            
         MOVE      KeyLine1 TO Line1A                                                                                                                                                                                                                          
         MOVE      KeyLine2 TO Line2A                                                                                                                                                                                                                          
         MOVE      KeyLine3 TO Line3A                                                                                                                                                                                                                          
         MOVE      KeyLine4 TO Line4A                                                                                                                                                                                                                          
         MOVE      KeyLine5 TO Line5A                                                                                                                                                                                                                          
         MOVE      "2" TO Label               /* Now ready for label 2                                                                                                                                                                                         
         ADD       "1" TO NbrLbls                                                                                                                                                                                                                              
         DISPLAY   *P1:24:                                                                                                                                                                                                                                     
                   "   Total number of labels printed--------->":                                                                                                                                                                                              
                   *EL,NbrLbls;                                                                                                                                                                                                                                
         GOTO      GETHC                                                                                                                                                                                                                                       
PRINTM2                                                                                                                                                                                                                                                        
         UNPACK    SPACES TO Line1B                                                                                                                                                                                                                            
         UNPACK    SPACES TO Line2B                                                                                                                                                                                                                            
         UNPACK    SPACES TO Line3B                                                                                                                                                                                                                            
         UNPACK    SPACES TO Line4B                                                                                                                                                                                                                            
         UNPACK    SPACES TO Line5B                                                                                                                                                                                                                            
         MOVE      KeyLine1 TO Line1B                                                                                                                                                                                                                          
         MOVE      KeyLine2 TO Line2B                                                                                                                                                                                                                          
         MOVE      KeyLine3 TO Line3B                                                                                                                                                                                                                          
         MOVE      KeyLine4 TO Line4B                                                                                                                                                                                                                          
         MOVE      KeyLine5 TO Line5B                                                                                                                                                                                                                          
         PRINT     *N:                                                                                                                                                                                                                                         
                   *3,Line1A,*44,Line1B,*N:                                                                                                                                                                                                                    
                   *3,Line2A,*44,Line2B,*N:                                                                                                                                                                                                                    
                   *3,Line3A,*44,Line3B,*N:                                                                                                                                                                                                                    
                   *3,Line4A,*44,Line4B,*N:                                                                                                                                                                                                                    
                   *3,Line5A,*44,Line5B                                                                                                                                                                                                                        
         MOVE      "1" TO Label               /* Now ready for label 1                                                                                                                                                                                         
         ADD       "1" TO NbrLbls                                                                                                                                                                                                                              
         DISPLAY   *P1:24:                                                                                                                                                                                                                                     
                   "   Total number of labels printed--------->":                                                                                                                                                                                              
                   *EL,NbrLbls;                                                                                                                                                                                                                                
         GOTO      GETHC                                                                                                                                                                                                                                       
                                                                                                                                                                                                                                                               
. This point is entered after the spool file is processed                                                                                                                                                                                                      
ReadCF                                                                                                                                                                                                                                                         
         CMATCH    "N" TO SELECTED                                                                                                                                                                                                                             
         GOTO      ReadCF2 IF EQUAL                                                                                                                                                                                                                            
         CMATCH    "M" TO SELECTED                                                                                                                                                                                                                             
         GOTO      Manual IF EQUAL                                                                                                                                                                                                                             
         UNPACK    SPACES TO KEY                                                                                                                                                                                                                               
         UNPACK    SPACES TO SaveKey    /* Selected labels can print twice...                                                                                                                                                                                  
         KEYIN     *P1:16,*COLOR 23:                                                                                                                                                                                                                           
                   *P1:16,*EL,*P1:17,*EL,*P1:18,*EL,*P1:19,*EL:                                                                                                                                                                                                
                   *P1:20,*EL,*P1:21,*EL,*P1:22,*EL,*P1:23,*EL:                                                                                                                                                                                                
                   *P1:15,"Enter filename for customer: ":                                                                                                                                                                                                     
                   *P29:15,*HON," [",*DV,KEY,"] ",*HOFF:                                                                                                                                                                                                       
                   *P31:15,*UC,*RV,*JL,KEY,*LC:                                                                                                                                                                                                                
                   *P29:15,*HON," [",*DV,KEY,"] ",*HOFF,*EL:                                                                                                                                                                                                   
                   *P1:16,*LC;                                                                                                                                                                                                                                 
         MATCH     SPACES TO KEY                                                                                                                                                                                                                               
         GOTO      GetHC IF EQUAL                                                                                                                                                                                                                              
         GOTO      ReadCFBP                                                                                                                                                                                                                                    
ReadCF2                                                                                                                                                                                                                                                        
         READKS    CTRLFILE;RecIn                                                                                                                                                                                                                              
         GOTO      EOJExit IF OVER                                                                                                                                                                                                                             
         UNPACK    RecIn TO DIM1, DIM60                                                                                                                                                                                                                        
         MATCH     TOF TO DIM1                                                                                                                                                                                                                                 
         GOTO      ReadCF IF EQUAL                                                                                                                                                                                                                             
         MATCH     BOF TO DIM1                                                                                                                                                                                                                                 
         GOTO      EOJExit IF EQUAL                                                                                                                                                                                                                            
         UNPACK    RecIn TO KEY, DIM60                                                                                                                                                                                                                         
ReadCFBP                                                                                                                                                                                                                                                       
                                                                                                                                                                                                                                                               
*        KEYIN     *R,*P1:24,*DV,KEY,*DV,DIM60:                                                                                                                                                                                                                
*                  REPLY;                                                                                                                                                                                                                                      
                                                                                                                                                                                                                                                               
         REPLACE   LC2UC IN KEY              /* Force Upper Case                                                                                                                                                                                               
         MATCH     KEY TO SaveKey                                                                                                                                                                                                                              
         GOTO      ReadCF IF EQUAL           /* Only 1 rtn label per cust req'd                                                                                                                                                                                
         MOVE      KEY TO SaveKey                                                                                                                                                                                                                              
                                                                                                                                                                                                                                                               
ScanCM                                                                                                                                                                                                                                                         
         READ      CustFNi,KEY;CustRcd                                                                                                                                                                                                                         
         GOTO      CustNF IF OVER                                                                                                                                                                                                                              
                                                                                                                                                                                                                                                               
. Changes needed to user CustFNi                                                                                                                                                                                                                               
                                                                                                                                                                                                                                                               
GotCMRec                                                                                                                                                                                                                                                       
. We have found the mailing label, print it...                                                                                                                                                                                                                 
PrintLbl                                                                                                                                                                                                                                                       
         CMATCH    "Y" TO Firstime                                                                                                                                                                                                                             
         CALL      InitPrtr IF EQUAL                                                                                                                                                                                                                           
                                                                                                                                                                                                                                                               
Print1                                                                                                                                                                                                                                                         
         MATCH     "2" TO Label                                                                                                                                                                                                                                
         GOTO      Print2 IF EQUAL                                                                                                                                                                                                                             
                                                                                                                                                                                                                                                               
         MOVE      Spaces TO Line1A                                                                                                                                                                                                                            
         MOVE      Spaces TO Line2A                                                                                                                                                                                                                            
         MOVE      Spaces TO Line3A                                                                                                                                                                                                                            
         MOVE      Spaces TO Line4A                                                                                                                                                                                                                            
         MOVE      Spaces TO Line5A                                                                                                                                                                                                                            
                                                                                                                                                                                                                                                               
         MOVE      CustAttn TO Line1A                                                                                                                                                                                                                          
         MOVE      CustName TO Line2A                                                                                                                                                                                                                          
         MOVE      CustAddr TO Line3A                                                                                                                                                                                                                          
                                                                                                                                                                                                                                                               
         ENDSET    CustCity                                                                                                                                                                                                                                    
         LENSET    CustCity                                                                                                                                                                                                                                    
CtyLoop1                                                                                                                                                                                                                                                       
         CMATCH    " " TO CustCity                                                                                                                                                                                                                             
         GOTO      CtyLoop2 IF NOT EQUAL                                                                                                                                                                                                                       
         BUMP      CustCity BY -1                                                                                                                                                                                                                              
         GOTO      CtyLoop1                                                                                                                                                                                                                                    
CtyLoop2                                                                                                                                                                                                                                                       
         LENSET    CustCity                                                                                                                                                                                                                                    
         RESET     CustCity                                                                                                                                                                                                                                    
                                                                                                                                                                                                                                                               
         PACK      Line4A FROM CustCity, ", ", CustSte, "  ", CustZip, Spaces                                                                                                                                                                                  
                                                                                                                                                                                                                                                               
         ADD       "1" TO NbrLbls                                                                                                                                                                                                                              
         DISPLAY   *P1:24:                                                                                                                                                                                                                                     
                   "   Total number of labels printed--------->":                                                                                                                                                                                              
                   *EL,NbrLbls;                                                                                                                                                                                                                                
         MOVE      "2" TO Label               /* Now ready for label 2                                                                                                                                                                                         
         GOTO      ReadCF                                                                                                                                                                                                                                      
.                                                                                                                                                                                                                                                              
Print2                                                                                                                                                                                                                                                         
         MATCH     "1" TO Label                                                                                                                                                                                                                                
         GOTO      Print1 IF EQUAL                                                                                                                                                                                                                             
                                                                                                                                                                                                                                                               
         MOVE      SPACES TO Line1B                                                                                                                                                                                                                            
         MOVE      SPACES TO Line2B                                                                                                                                                                                                                            
         MOVE      SPACES TO Line3B                                                                                                                                                                                                                            
         MOVE      SPACES TO Line4B                                                                                                                                                                                                                            
         MOVE      SPACES TO Line5B                                                                                                                                                                                                                            
                                                                                                                                                                                                                                                               
         MOVE      CustAttn TO Line1B                                                                                                                                                                                                                          
         MOVE      CustName TO Line2B                                                                                                                                                                                                                          
         MOVE      CustAddr TO Line3B                                                                                                                                                                                                                          
                                                                                                                                                                                                                                                               
         ENDSET    CustCity                                                                                                                                                                                                                                    
         LENSET    CustCity                                                                                                                                                                                                                                    
CtyLoop3                                                                                                                                                                                                                                                       
         CMATCH    " " TO CustCity                                                                                                                                                                                                                             
         GOTO      CtyLoop4 IF NOT EQUAL                                                                                                                                                                                                                       
         BUMP      CustCity BY -1                                                                                                                                                                                                                              
         GOTO      CtyLoop3                                                                                                                                                                                                                                    
CtyLoop4                                                                                                                                                                                                                                                       
         LENSET    CustCity                                                                                                                                                                                                                                    
         RESET     CustCity                                                                                                                                                                                                                                    
                                                                                                                                                                                                                                                               
         PACK      Line4B FROM CustCity, ", ", CustSte, "  ", CustZip, Spaces                                                                                                                                                                                  
                                                                                                                                                                                                                                                               
         ADD       "1" TO NbrLbls                                                                                                                                                                                                                              
                                                                                                                                                                                                                                                               
         PRINT     *N:                                                                                                                                                                                                                                         
                   *3,Line1A,*44,Line1B,*N:                                                                                                                                                                                                                    
                   *3,Line2A,*44,Line2B,*N:                                                                                                                                                                                                                    
                   *3,Line3A,*44,Line3B,*N:                                                                                                                                                                                                                    
                   *3,Line4A,*44,Line4B,*N:                                                                                                                                                                                                                    
                   *3,Line5A,*44,Line5B                                                                                                                                                                                                                        
         MOVE      "1" TO Label               /* Now ready for label 1                                                                                                                                                                                         
         DISPLAY   *P1:24:                                                                                                                                                                                                                                     
                   "   Total number of labels printed--------->":                                                                                                                                                                                              
                   *EL,NbrLbls;                                                                                                                                                                                                                                
         GOTO      ReadCF                                                                                                                                                                                                                                      
                                                                                                                                                                                                                                                               
InitPrtr                                                                                                                                                                                                                                                       
                                                                                                                                                                                                                                                               
* No-Op  PRINT     InitLbl                                                                                                                                                                                                                                     
         CMOVE     "N" TO Firstime                                                                                                                                                                                                                             
         RETURN                                                                                                                                                                                                                                                
                                                                                                                                                                                                                                                               
.    EOJ PROCESSING                                                                                                                                                                                                                                            
                                                                                                                                                                                                                                                               
EOJExit                                                                                                                                                                                                                                                        
         MATCH     "1" TO Label                                                                                                                                                                                                                                
         GOTO      NoPrint IF EQUAL                                                                                                                                                                                                                            
         ADD       "1" TO NbrLbls                                                                                                                                                                                                                              
                                                                                                                                                                                                                                                               
         MOVE      SPACES TO Line1B                                                                                                                                                                                                                            
         MOVE      SPACES TO Line2B                                                                                                                                                                                                                            
         MOVE      SPACES TO Line3B                                                                                                                                                                                                                            
         MOVE      SPACES TO Line4B                                                                                                                                                                                                                            
         MOVE      SPACES TO Line5B                                                                                                                                                                                                                            
                                                                                                                                                                                                                                                               
         PRINT     *N:                                                                                                                                                                                                                                         
                   *3,Line1A,*44,Line1B,*N:                                                                                                                                                                                                                    
                   *3,Line2A,*44,Line2B,*N:                                                                                                                                                                                                                    
                   *3,Line3A,*44,Line3B,*N:                                                                                                                                                                                                                    
                   *3,Line4A,*44,Line4B,*N:                                                                                                                                                                                                                    
                   *3,Line5A,*44,Line5B                                                                                                                                                                                                                        
         MOVE      "1" TO Label               /* Now ready for label 1                                                                                                                                                                                         
NOPRINT                                                                                                                                                                                                                                                        
         KEYIN     *P1:24:                                                                                                                                                                                                                                     
                   "   Total number of labels printed--------->":                                                                                                                                                                                              
                   *EL,*HON," ",*DV,NbrLbls," ",*HOFF,"   Printing Complete ":                                                                                                                                                                                 
                   *P75:24,*CL,REPLY;                                                                                                                                                                                                                          
         CMATCH    "Y" TO INTSW                                                                                                                                                                                                                                
         GOTO      NOREL IF NOT EQUAL                                                                                                                                                                                                                          
         DISPLAY   *B,*R,*P1:24:                                                                                                                                                                                                                               
                   "  Printing has been interrupted....";                                                                                                                                                                                                      
NOREL                                                                                                                                                                                                                                                          
                                                                                                                                                                                                                                                               
.    Reset the laser printer                                                                                                                                                                                                                                   
                                                                                                                                                                                                                                                               
         PRINT     ResetLJ;       /* Reset the laser printer                                                                                                                                                                                                   
         SPLCLOSE  SFNAME         /* 1/6/86...JMM                                                                                                                                                                                                              
         CLOSE     CTRLFILE                                                                                                                                                                                                                                    
         CLOSE     CustFNi                                                                                                                                                                                                                                     
         TRAP      NoMenu IF CFAIL                                                                                                                                                                                                                             
         CHAIN     "TJONMENU"             GO BACK TO MENU    12/5...JMM                                                                                                                                                                                        
.                                                                                                                                                                                                                                                              
ShutDown                                                                                                                                                                                                                                                       
         CMATCH    "M" TO SELECTED                                                                                                                                                                                                                             
         GOTO      EOJExit IF EQUAL                                                                                                                                                                                                                            
         CMATCH    "Y" TO SELECTED                                                                                                                                                                                                                             
         GOTO      EOJExit IF EQUAL                                                                                                                                                                                                                            
MenuExit                                                                                                                                                                                                                                                       
         TRAP      NoMenu IF CFAIL                                                                                                                                                                                                                             
         CHAIN     "TJONMENU"             GO BACK TO MENU    12/5...JMM                                                                                                                                                                                        
NoMenu   STOP                                                                                                                                                                                                                                                  
                                                                                                                                                                                                                                                               
INT                                                                                                                                                                                                                                                            
         NORETURN                                                                                                                                                                                                                                              
         CMOVE     "Y" TO INTSW                                                                                                                                                                                                                                
         GOTO      EOJEXIT                                                                                                                                                                                                                                     
.                                                                                                                                                                                                                                                              
. The following routine will position to the desired label on the page                                                                                                                                                                                         
.                                                                                                                                                                                                                                                              
POSITION                                                                                                                                                                                                                                                       
         MOVE      "1" TO LABEL                      /* Assume right label                                                                                                                                                                                     
         MOVE      DIM2 TO NUMWK3                                                                                                                                                                                                                              
         MOVE      DIM2 TO NUMWK2A                                                                                                                                                                                                                             
         DIVIDE    "2" INTO NUMWK3                                                                                                                                                                                                                             
         MOVE      NUMWK3 TO NUMWK2B                                                                                                                                                                                                                           
         MULTIPLY  "2" BY   NUMWK2B                                                                                                                                                                                                                            
         COMPARE   NUMWK2A TO NUMWK2B                                                                                                                                                                                                                          
         GOTO      POSLOOP IF EQUAL                                                                                                                                                                                                                            
         MOVE      "2" TO LABEL             /* Position on left label                                                                                                                                                                                          
                                                                                                                                                                                                                                                               
POSLOOP                                                                                                                                                                                                                                                        
                                                                                                                                                                                                                                                               
*        DISPLAY   *P1:24," Numwk2A=",NUMWK2A:                                                                                                                                                                                                                 
*                  " Numwk3=",NUMWK3:                                                                                                                                                                                                                          
*                  " Numwk2B=",NUMWK2B:                                                                                                                                                                                                                        
*                  " DIM2=",DIM2:                                                                                                                                                                                                                              
*                  *EL;                                                                                                                                                                                                                                        
*        KEYIN     REPLY;                                                                                                                                                                                                                                      
                                                                                                                                                                                                                                                               
         COMPARE   "0" TO NUMWK2B                                                                                                                                                                                                                              
         GOTO      POSEXIT IF EQUAL                                                                                                                                                                                                                            
         SUBTRACT  "2" FROM NUMWK2B                                                                                                                                                                                                                            
         MOVE      SPACES TO Line1A                                                                                                                                                                                                                            
         MOVE      SPACES TO Line2A                                                                                                                                                                                                                            
         MOVE      SPACES TO Line3A                                                                                                                                                                                                                            
         MOVE      SPACES TO Line4A                                                                                                                                                                                                                            
         MOVE      SPACES TO Line5A                                                                                                                                                                                                                            
         PRINT     *N:                                                                                                                                                                                                                                         
                   *N:                                                                                                                                                                                                                                         
                   *N:                                                                                                                                                                                                                                         
                   *N:                                                                                                                                                                                                                                         
                   *N                                                                                                                                                                                                                                          
         GOTO      POSLOOP                                                                                                                                                                                                                                     
POSEXIT                                                                                                                                                                                                                                                        
         RETURN                                                                                                                                                                                                                                                
                                                                                                                                                                                                                                                               
CKSF                                                                                                                                                                                                                                                           
         CMATCH    "Y" TO SFOpenSW        /* Is the spool file open?                                                                                                                                                                                           
         GOTO      CKSFEXIT IF EQUAL      /* Yes, exit this routine                                                                                                                                                                                            
         TRAP      NEWSF IF IO                                                                                                                                                                                                                                 
         CLEAR     SFNAME                                                                                                                                                                                                                                      
         APPEND    "TDSLBLPR.PRT" TO SFNAME                                                                                                                                                                                                                    
         RESET     SFNAME                                                                                                                                                                                                                                      
         OPEN      SPLFILE,SFNAME                                                                                                                                                                                                                              
         CLOSE     SPLFILE,SFNAME                                                                                                                                                                                                                              
         TRAPCLR   IO                                                                                                                                                                                                                                          
         KEYIN     *B,*P1:24,*EL:                                                                                                                                                                                                                              
                   "The print file ",*LL,*DV,SFNAME," already exists! ":                                                                                                                                                                                       
                   *P56:24," Write over? (Y/N)",*CL,*-,*UC,REPLY,*LC;                                                                                                                                                                                          
         CMATCH    "Y" TO REPLY                                                                                                                                                                                                                                
         GOTO      NEWSF2 IF EQUAL                                                                                                                                                                                                                             
         KEYIN     *P56:24,*EL,"Append to the end? (Y/N)":                                                                                                                                                                                                     
                   *CL,*-,*UC,REPLY,*LC;                                                                                                                                                                                                                       
         CMATCH    "Y" TO REPLY                                                                                                                                                                                                                                
         GOTO      MenuExit IF NOT EQUAL                                                                                                                                                                                                                       
         SPLOPEN   SFNAME,"Q"        /* APPEND TO THE CURRENT SPOOLFILE                                                                                                                                                                                        
         GOTO      CKSFEXIT          /* AND EXIT THE SPOOL FILE START RTN                                                                                                                                                                                      
NEWSF                                                                                                                                                                                                                                                          
         NORETURN                                                                                                                                                                                                                                              
         TRAPCLR   IO                                                                                                                                                                                                                                          
         CLEAR     REPLY                                                                                                                                                                                                                                       
         MOVE      "C" TO REPLY               /* Force drive C:  12/1/92                                                                                                                                                                                       
         GOTO      NEWSF3                                                                                                                                                                                                                                      
ASKNEWSF                                                                                                                                                                                                                                                       
         KEYIN     *P1:24,*EL,"Create ",*LL,*DV,SFNAME," on which drive? ":                                                                                                                                                                                    
                   *CL,*-,"    ?:",*P47:24,*UC,REPLY,*LC;                                                                                                                                                                                                      
         CMATCH   "C" to reply                                                                                                                                                                                                                                 
         goto      newsf3 if equal                                                                                                                                                                                                                             
         CMATCH   "D" to reply                                                                                                                                                                                                                                 
         goto      newsf3 if equal                                                                                                                                                                                                                             
         CMATCH   "A" to reply                                                                                                                                                                                                                                 
         goto      newsf3 if equal                                                                                                                                                                                                                             
         goto      newsf if not eos                                                                                                                                                                                                                            
         move      "C" to reply            /* Will default to C drive                                                                                                                                                                                          
         GOTO      NEWSF3                                                                                                                                                                                                                                      
NEWSF2                                                                                                                                                                                                                                                         
         CMOVE     " " TO REPLY                                                                                                                                                                                                                                
         MOVE      SPACES TO DRIVE                                                                                                                                                                                                                             
         CLEAR     REPLY                                                                                                                                                                                                                                       
         CLEAR     DRIVE                                                                                                                                                                                                                                       
NEWSF3                                                                                                                                                                                                                                                         
         CLEAR     SFNAME                                                                                                                                                                                                                                      
         APPEND    Reply TO SFName             /*                                                                                                                                                                                                              
         APPEND    Drive TO SFName             /* Now using PC filename stds                                                                                                                                                                                   
         APPEND    "TDSLBLPR.PRT " TO SFNAME   /* Example D:filename.ext                                                                                                                                                                                       
         LENSET    SFNAME                                                                                                                                                                                                                                      
         RESET     SFNAME                                                                                                                                                                                                                                      
         SPLOPEN   SFNAME                                                                                                                                                                                                                                      
CKSFEXIT                                                                                                                                                                                                                                                       
         CMOVE     "Y" TO SFOpenSW             /* The Spoolfile is open                                                                                                                                                                                        
         CMATCH    "N" TO Firstime                                                                                                                                                                                                                             
         GOTO      ReadCF IF EQUAL                                                                                                                                                                                                                             
         MOVE      "0" TO REPLY                                                                                                                                                                                                                                
         KEYIN     *P1:14,"Enter the number of 'empty' labels to skip: ":                                                                                                                                                                                      
                   *EL,*+,*DE,*RV,DIM2;                                                                                                                                                                                                                        
         CALL      POSITION                                                                                                                                                                                                                                    
         GOTO      ReadCF                                                                                                                                                                                                                                      
                                                                                                                                                                                                                                                               
NoCM                                                                                                                                                                                                                                                           
         DISPLAY   *B,*N,*COLOR 124,*EL:                                                                                                                                                                                                                       
                   "C:\TDS\CustFNi <====== Required Data File does not exist.";                                                                                                                                                                                
         MOVE      "05" TO S$RETVAL                 ;; Set an 'Error' Return                                                                                                                                                                                   
         TRAPCLR   IO                                                                                                                                                                                                                                          
         FILEPI    0                                                                                                                                                                                                                                           
         STOP                                                                                                                                                                                                                                                  
                                                                                                                                                                                                                                                               
CFMISS                                                                                                                                                                                                                                                         
         KEYIN     *B,*P1:24,*EL,"Control File is missing. [":                                                                                                                                                                                                 
                   *DV,*LL,CFName,"] ",*CL:                                                                                                                                                                                                                    
                   REPLY;                                                                                                                                                                                                                                      
         STOP                                                                                                                                                                                                                                                  
                                                                                                                                                                                                                                                               
. ============================================================================                                                                                                                                                                                 
. Customer Name not found in CUSTMAST file.... error message and skip                                                                                                                                                                                          
CustNF                                                                                                                                                                                                                                                         
         KEYIN     *B,*N,*COLOR 124,*EL:                                                                                                                                                                                                                       
                   *DV,KEY," <== Customer not in CUSTMAST... Bypassed. ":                                                                                                                                                                                      
                   Reply;                                                                                                                                                                                                                                      
         GOTO      ReadCF                                                                                                                                                                                                                                      
                                                                                                                                                                                                                                                               
EOJ      MOVE      "Y" TO EOJSW                                                                                                                                                                                                                                
         TRAPCLR   RANGE                                                                                                                                                                                                                                       
         GOTO      EOJExit                                                                                                                                                                                                                                     
